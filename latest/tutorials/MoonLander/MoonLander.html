<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Moon Lander · NLOptControl.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/highlightjs/default.css" rel="stylesheet" type="text/css"/><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>NLOptControl.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" action="../../search.html"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../index.html">Home</a></li><li><span class="toctext">Tutorials</span><ul><li><a class="toctext" href="../BrysonDenham/BrysonDenham.html">Bryson Denham</a></li><li class="current"><a class="toctext" href="MoonLander.html">Moon Lander</a><ul class="internal"><li><a class="toctext" href="#The-next-part-is-optional:-1">The next part is optional:</a></li></ul></li><li><a class="toctext" href="../KinematicBicycle/KinematicBicycle.html">initialize</a></li><li><a class="toctext" href="../HyperSensitive/main.html">HyperSensitive</a></li></ul></li><li><span class="toctext">Background Information</span><ul><li><a class="toctext" href="../../background/index.html">Background Information</a></li></ul></li><li><span class="toctext">Exported Functions</span><ul><li><a class="toctext" href="../../functions/NLOptControl.html">NLOptControl.jl</a></li><li><a class="toctext" href="../../functions/VehicleModels.html">VehicleModels.jl</a></li><li><a class="toctext" href="../../functions/PrettyPlots.html">PrettyPlots.jl</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li>Tutorials</li><li><a href="MoonLander.html">Moon Lander</a></li></ul><a class="edit-page" href="https://github.com/JuliaMPC/MPCDocs.jl/tree/16ab24147d998996f136dcf506b44e77ede125f5/docs/src/tutorials/MoonLander/MoonLander.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Moon Lander</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Moon-Lander-1" href="#Moon-Lander-1">Moon Lander</a></h1><p>First setup the packages that will be used:</p><div><pre><code class="language-julia">using NLOptControl,JuMP,Parameters,PrettyPlots,Plots;gr()
n=NLOpt();</code></pre></div><p>Where, the object <code>n</code> is the object for the entire optimal control problem including: |setting               | keys        | descriptions           | | –––––––––– | –––––- | ––––––––––– | |n.s.integrationMethod | :tm         | time marching          |                        | :ps         | pseudospectral methods | <code>n.s</code> for settings <code>n.r</code> for results <code>n.mpc</code> for mpc data</p><p>Next define the basic differential equation used to model the system:</p><pre><code class="language-">const g = 1.62519; # m/s^2
function MoonLander{T&lt;:Any}(mdl::JuMP.Model,n::NLOpt,r::Result,x::Array{T,2},u::Array{T,2}) # dynamic constraint equations
  if n.integrationMethod==:tm; L=size(x)[1]; else L=size(x)[1]-1; end
  dx = Array(Any,L,n.numStates)
  dx[:,1] = @NLexpression(mdl, [j=1:L], x[j,2] );
  dx[:,2] = @NLexpression(mdl, [j=1:L], u[j,1] - g);
  return dx
end
nothing # hide</code></pre><p>Most of this code is boiler-plate and should be copied directly. The important things to note are that<code>u</code> is the control variable matrix and <code>x</code> is the state variable matrix. So, in the above example the only thing that the user needs to modify is the right hand side of the <code>dx[]</code> expressions. The indecies for the number of the state or control variable are in the columns. For instance, <code>x[:,2]</code> represents the entire vector for second state variable.</p><p>NOTE: eventually most of this code will be pushed to a lower level.  </p><p>Now that the dynamic constraint equations have been established, the next step is to define the problem:</p><div><pre><code class="language-julia">define!(n,stateEquations=MoonLander,numStates=2,numControls=1,X0=[10.,-2],XF=[0.,0.],XL=[NaN,NaN],XU=[NaN,NaN],CL=[0.],CU=[3.]);</code></pre></div><p>To do this the user passes <code>n</code>, and defines the <code>stateEquations</code> to be the dynamic constraint equations defined in <code>MoonLander()</code>.</p><p>Basics: <code>numStates</code> = number of state variables <code>numControls</code> = number of control variables <code>X0</code> = intial sttae TODO-&gt; mention XL etc.</p><p>There are several different ways to ensure that the <code>stateEquations</code> are satisfied that are set using the keys <code>:integrationMethod</code> and <code>:integrationScheme</code>. In this example the hp-Gaussian Quadrature Collocation Method is used with Radau Nodes. Finally, the final time may be either fixed and set before hand or it can be a variable. This option is set using the <code>:finalTimeDV</code> key and it is set to <code>true</code> in this example.</p><pre><code class="language-">configure!(n,Ni=4,Nck=[10,10,10,10];(:integrationMethod=&gt;:ps),(:integrationScheme=&gt; :lgrExplicit),(:finalTimeDV=&gt;true));
nothing # hide</code></pre><p>The next parts are optional.</p><ol><li><p>Names and descriptions may be added to both the control and state variables as follows:</p></li></ol><pre><code class="language-">names=[:h,:v]; descriptions = [&quot;h(t)&quot;,&quot;v(t)&quot;]; stateNames!(n,names,descriptions);
nothing # hide</code></pre><p>NOTE: The names will show up in the results data and the descriptions will show up in the graphs</p><ol><li><p>Another option is to define the solver and some optimization settings as:</p></li></ol><pre><code class="language-">mdl=defineSolver!(n;name=:IPOPT,max_iter=1000,feastol_abs=1.0e-3,infeastol=1.0e-8,opttol_abs=1.0e-3);
nothing # hide</code></pre><p>Now, back to the required parts. The optimal control problem must be defined as:</p><pre><code class="language-">r=OCPdef!(mdl,n,s);
nothing # hide</code></pre><p>The object <code>r</code> stores all of the results as well as both the control and state variables. For instance <code>r.x[:,1]</code> should now be used to access the entire vector for the first state.</p><p>For generality, <code>integrate!()</code> will also be demonstrated in this example. <code>integrate!()</code> is used to add terms to the cost function that need to be integrated. Currently there are several forms that these integrals can take (more can be added). In this example the first control variable <code>r.u[:,1]</code> and sets up this variable to be integrated over the entire time of the control problem with the following line of code:</p><pre><code class="language-">obj=integrate!(mdl,n,r.u[:,1];C=1.0,(:variable=&gt;:control),(:integrand=&gt;:default));
nothing # hide</code></pre><p>Next the cost function can be defined as:</p><pre><code class="language-">@NLobjective(mdl, Min, obj);
nothing # hide</code></pre><p>At this stage, the optimal control problem can be solved with:</p><pre><code class="language-">optimize!(mdl,n,r,s);
nothing # hide</code></pre><p>Then, in order to quickly visualize the problem, functionality is also provided for automated visualization.</p><h2><a class="nav-anchor" id="The-next-part-is-optional:-1" href="#The-next-part-is-optional:-1">The next part is optional:</a></h2><p>The plot settings can be modified from the default using the following code:</p><div><pre><code class="language-julia">plotSettings(;(:mpc_lines =&gt;[(4.0,:blue,:solid)]),(:size=&gt;(700,700)));</code></pre></div><p>Then, in order to create a new directory to store the plots in call:</p><pre><code class="language-">resultsDir!(r);
nothing # hide</code></pre><p>Finally, in order to plot all of the states and controls call:</p><pre><code class="language-">allPlots(n,r,1);</code></pre><footer><hr/><a class="previous" href="../BrysonDenham/BrysonDenham.html"><span class="direction">Previous</span><span class="title">Bryson Denham</span></a><a class="next" href="../KinematicBicycle/KinematicBicycle.html"><span class="direction">Next</span><span class="title">initialize</span></a></footer></article></body></html>
