<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quick Ex#1: Brachistochrone · NLOptControl.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>NLOptControl.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" action="../../search.html"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../index.html">Home</a></li><li><span class="toctext">Tutorials</span><ul><li class="current"><a class="toctext" href="main.html">Quick Ex#1: Brachistochrone</a><ul class="internal"><li><a class="toctext" href="#Find:-1">Find:</a></li><li><a class="toctext" href="#Solution:-1">Solution:</a></li><li><a class="toctext" href="#Packages-that-will-be-used-1">Packages that will be used</a></li><li><a class="toctext" href="#Define-the-Problem-1">Define the Problem</a></li><li><a class="toctext" href="#State-and-Control-Names-1">State and Control Names</a></li><li><a class="toctext" href="#Differential-Equations-1">Differential Equations</a></li><li><a class="toctext" href="#Configure-the-Problem-1">Configure the Problem</a></li><li><a class="toctext" href="#Objective-Function-1">Objective Function</a></li><li><a class="toctext" href="#Optimize-1">Optimize</a></li><li><a class="toctext" href="#Post-Process-1">Post Process</a></li></ul></li><li><a class="toctext" href="../MoonLander/main.html">Quick Ex#2: Moon Lander</a></li><li><a class="toctext" href="../BrysonDenham/main.html">Bryson Denham</a></li><li><a class="toctext" href="../Beam/main.html">Beam Problem</a></li><li><a class="toctext" href="../HyperSensitive/main.html">HyperSensitive</a></li><li><a class="toctext" href="../RobotArm/main.html">RobotArm</a></li><li><a class="toctext" href="../Rocket/main.html">Rocket</a></li><li><a class="toctext" href="../Unicycle/main.html">Unicycle Model</a></li><li><a class="toctext" href="../KinematicBicycle/main.html">Kinematic Bicycle Model</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li>Tutorials</li><li><a href="main.html">Quick Ex#1: Brachistochrone</a></li></ul><a class="edit-page" href="https://github.com/JuliaMPC/MPCDocs.jl/tree/c74775cefead9ef50d684074fa8890989fe5068d/docs/src/tutorials/Brachistochrone/main.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Quick Ex#1: Brachistochrone</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Quick-Ex#1:-Brachistochrone-1" href="#Quick-Ex#1:-Brachistochrone-1">Quick Ex#1: Brachistochrone</a></h1><h4><a class="nav-anchor" id="Solved-by:-John-and-Bernoulli,-Newton-and-L&#39;Hospital-1" href="#Solved-by:-John-and-Bernoulli,-Newton-and-L&#39;Hospital-1">Solved by: John and Bernoulli, Newton and L&#39;Hospital</a></h4><h3><a class="nav-anchor" id="Given:-1" href="#Given:-1">Given:</a></h3><h4><a class="nav-anchor" id="A-particle-sliding-without-friction-along-an-unknown-track-in-a-gravitational-field-1" href="#A-particle-sliding-without-friction-along-an-unknown-track-in-a-gravitational-field-1">A particle sliding without friction along an unknown track in a gravitational field</a></h4><h4><a class="nav-anchor" id="Dynamic-Constraints-1" href="#Dynamic-Constraints-1">Dynamic Constraints</a></h4><div>\[\dot{x}_1(t)=x_3(t)sin(u_1(t))\]</div><div>\[\dot{x}_2(t)=-x_3(t)cos(u_1(t))\]</div><div>\[\dot{x}_3(t)=gcos(u_1(t))\]</div><h4><a class="nav-anchor" id="Boundary-Conditions-1" href="#Boundary-Conditions-1">Boundary Conditions</a></h4><div>\[{x}_1(0)=0 \qquad {x}_1(t_f)=2\]</div><div>\[{x}_2(0)=0\qquad {x}_2(t_f)=-2\]</div><div>\[{x}_3(0)=0\qquad {x}_3(t_f)=free\]</div><h2><a class="nav-anchor" id="Find:-1" href="#Find:-1">Find:</a></h2><h4><a class="nav-anchor" id="The-track-that-minimizes-time-1" href="#The-track-that-minimizes-time-1">The track that minimizes time</a></h4><div>\[J=t_f\]</div><h2><a class="nav-anchor" id="Solution:-1" href="#Solution:-1">Solution:</a></h2><p>This problem can be found <a href="http://www.gpops2.com/Examples/Brachistochrone.html">here</a>.</p><h2><a class="nav-anchor" id="Packages-that-will-be-used-1" href="#Packages-that-will-be-used-1">Packages that will be used</a></h2><div><pre><code class="language-julia">using NLOptControl</code></pre></div><h2><a class="nav-anchor" id="Define-the-Problem-1" href="#Define-the-Problem-1">Define the Problem</a></h2><p>Next let&#39;s write down the boundary conditions into an array:</p><div><pre><code class="language-julia">X0=[0.0,0.0,0.0]
XF=[2.,-2.,NaN]</code></pre></div><h4><a class="nav-anchor" id="Notice:-1" href="#Notice:-1">Notice:</a></h4><ol><li><p>The numbers that where put into the expression are <code>Float64</code>; For now this is required!</p></li><li><p>The <code>NaN</code> is put into the boundary constraint for the third state; If any of the state bounds are free then pass a <code>NaN</code></p></li></ol><p>Now that we have the basic problem written down, we can call the <code>define()</code> function as:</p><div><pre><code class="language-julia">n=define(numStates=3,numControls=1,X0=X0,XF=XF);</code></pre></div><h4><a class="nav-anchor" id="Basics-1" href="#Basics-1">Basics</a></h4><table><tr><th>Variable</th><th>Description</th></tr><tr><td><code>n</code></td><td>object that holds the entire optimal control problem</td></tr><tr><td><code>de</code></td><td>array of differential equation expressions</td></tr><tr><td><code>numStates</code></td><td>the number of states</td></tr><tr><td><code>numControls</code></td><td>the number of controls</td></tr><tr><td><code>X0</code></td><td>intial state constraint</td></tr><tr><td><code>XF</code></td><td>final state constraint</td></tr></table><p>Also, not in this problem, but</p><table><tr><th>Variable</th><th>Description</th></tr><tr><td><code>XL</code></td><td>lower state bound</td></tr><tr><td><code>XU</code></td><td>upper state bound</td></tr><tr><td><code>CL</code></td><td>lower state bound</td></tr><tr><td><code>CU</code></td><td>upper control bound</td></tr></table><p>The above bounds can be set in the same fashion as the initial and final state constraints. i.e. in an Array.</p><h2><a class="nav-anchor" id="State-and-Control-Names-1" href="#State-and-Control-Names-1">State and Control Names</a></h2><div><pre><code class="language-julia">states!(n,[:x,:y,:v],descriptions=[&quot;x(t)&quot;,&quot;y(t)&quot;,&quot;v(t)&quot;]);
controls!(n,[:u],descriptions=[&quot;u(t)&quot;]);</code></pre></div><h2><a class="nav-anchor" id="Differential-Equations-1" href="#Differential-Equations-1">Differential Equations</a></h2><p>Now we need to write all of the given information out. Let&#39;s start with the differential equation, that is written as an array of expressions:</p><div><pre><code class="language-julia">dx=[:(v[j]*sin(u[j])),:(-v[j]*cos(u[j])),:(9.81*cos(u[j]))]
dynamics!(n,dx)</code></pre></div><h2><a class="nav-anchor" id="Configure-the-Problem-1" href="#Configure-the-Problem-1">Configure the Problem</a></h2><p>Now that the basic optimal control problem has been defined, the next step is to <code>configure!()</code> with additional options.</p><div><pre><code class="language-julia">configure!(n;(:Nck=&gt;[100]),(:finalTimeDV=&gt;true));</code></pre></div><h4><a class="nav-anchor" id="Settings:-1" href="#Settings:-1">Settings:</a></h4><table><tr><th>Key</th><th>Description</th></tr><tr><td><code>:Nck</code></td><td>array of that holds the number of points within each interval</td></tr><tr><td><code>:finalTimeDV</code></td><td>bool to indicate if time is a design variable</td></tr></table><h4><a class="nav-anchor" id="Notice:-2" href="#Notice:-2">Notice:</a></h4><ol><li><p>Final time is a design variable; we are trying to minimize it</p></li><li><p>We defined this as a single interval problem with <span>$100$</span> points</p></li></ol><h2><a class="nav-anchor" id="Objective-Function-1" href="#Objective-Function-1">Objective Function</a></h2><p>Finally, the objective function needs to be defined. For this, we use the <span>$JuMP$</span> macro <span>$@NLOptControl()$</span> directly as:</p><div><pre><code class="language-julia">@NLobjective(n.mdl,Min,n.tf);</code></pre></div><p>with,</p><table><tr><th>Variable</th><th>Description</th></tr><tr><td><code>n.mdl</code></td><td>object that holds them JuMP model</td></tr><tr><td><code>Min</code></td><td>for a minimization problem</td></tr><tr><td><code>n.tf</code></td><td>a reference to the final time</td></tr></table><h2><a class="nav-anchor" id="Optimize-1" href="#Optimize-1">Optimize</a></h2><p>Now that the entire optimal control problem has been defined we can <code>optimize!()</code> it as:</p><div><pre><code class="language-julia">optimize!(n);</code></pre></div><h2><a class="nav-anchor" id="Post-Process-1" href="#Post-Process-1">Post Process</a></h2><p><strong>Make sure that you are not running the code in a folder where you have an important folder named <code>results</code>, because it will be deleted!</strong> Now that the problem has been optimized, we can quickly visualize the solution using <span>$allPlots()$</span> as:</p><pre><code class="language-">using PrettyPlots
allPlots(n)</code></pre><h4><a class="nav-anchor" id="Optional-plot-settings-1" href="#Optional-plot-settings-1">Optional plot settings</a></h4><p>Many of the plot settings can be modified using the <code>plotSettings()</code> function. For instance;</p><div><pre><code class="language-julia">plotSettings(;(:size=&gt;(700,700)));</code></pre></div><p><code>allPlots()</code> automatically plots the solution to all of the state and control variables. In this problem, we may be interested in comparing two states against one another which can be done using the <code>statePlot()</code> function as:</p><pre><code class="language-">statePlot(n,1,1,2)</code></pre><p>For this case, there are four things that need to be passed to <code>statePlots()</code>:</p><table><tr><th>Argument</th><th>Name</th><th>Description</th></tr><tr><td>1</td><td><code>n</code></td><td>object that holds the entire optimal control problem</td></tr><tr><td>2</td><td><code>idx</code></td><td>reference to solution number used when we start solving <code>mpc</code> problems</td></tr><tr><td>3</td><td><code>st1</code></td><td>state number for <code>xaxis</code></td></tr><tr><td>4</td><td><code>st2</code></td><td>state number for <code>yaxis</code></td></tr></table><h4><a class="nav-anchor" id="Data-Orginization-1" href="#Data-Orginization-1">Data Orginization</a></h4><p>All of the states, control variables and time vectors are stored in an array of Dataframes called <code>n.r.dfs</code></p><div><pre><code class="language-julia">n.r.dfs</code></pre><pre><code class="language-none">1-element Array{Any,1}:
 101×5 DataFrames.DataFrame
│ Row │ t           │ x           │ y            │ v          │ u           │
├─────┼─────────────┼─────────────┼──────────────┼────────────┼─────────────┤
│ 1   │ 0.0         │ 0.0         │ 0.0          │ 0.0        │ 5.82398e-14 │
│ 2   │ 0.000302536 │ 1.32471e-10 │ -4.48945e-7  │ 0.00296788 │ 0.000442609 │
│ 3   │ 0.0010139   │ 4.98629e-9  │ -5.04231e-6  │ 0.00994636 │ 0.00148333  │
│ 4   │ 0.00213113  │ 4.63039e-8  │ -2.2277e-5   │ 0.0209063  │ 0.00311783  │
│ 5   │ 0.00365302  │ 2.33209e-7  │ -6.54545e-5  │ 0.035836   │ 0.00534436  │
│ 6   │ 0.00557807  │ 8.30305e-7  │ -0.000152615 │ 0.0547203  │ 0.00816071  │
│ 7   │ 0.00790437  │ 2.36255e-6  │ -0.000306446 │ 0.0775401  │ 0.0115641   │
│ 8   │ 0.0106296   │ 5.74545e-6  │ -0.000554166 │ 0.104272   │ 0.0155511   │
⋮
│ 93  │ 0.812177    │ 1.92932     │ -1.97229     │ 6.22063    │ 1.18821     │
│ 94  │ 0.815101    │ 1.94622     │ -1.97905     │ 6.23128    │ 1.19249     │
│ 95  │ 0.817627    │ 1.96087     │ -1.98484     │ 6.24039    │ 1.19619     │
│ 96  │ 0.819753    │ 1.97323     │ -1.98968     │ 6.24799    │ 1.1993      │
│ 97  │ 0.821477    │ 1.98328     │ -1.99357     │ 6.25411    │ 1.20182     │
│ 98  │ 0.822796    │ 1.99098     │ -1.99654     │ 6.25877    │ 1.20375     │
│ 99  │ 0.823711    │ 1.99633     │ -1.9986      │ 6.26198    │ 1.20509     │
│ 100 │ 0.824219    │ 1.9993      │ -1.99973     │ 6.26377    │ 1.20583     │
│ 101 │ 0.824339    │ 2.0         │ -2.0         │ 6.26418    │ NaN         │</code></pre></div><p>It is an array because the problem is designed to be solved multiple times in a receding time horizon. The variables can be accessed like this:</p><div><pre><code class="language-julia">n.r.dfs[1][:x][1:4]</code></pre><pre><code class="language-none">4-element DataArrays.DataArray{Float64,1}:
 0.0
 1.32471e-10
 4.98629e-9
 4.63039e-8</code></pre></div><h4><a class="nav-anchor" id="Optimization-Data-1" href="#Optimization-Data-1">Optimization Data</a></h4><div><pre><code class="language-julia">n.r.dfs_opt</code></pre><pre><code class="language-none">1-element Array{Any,1}:
 1×4 DataFrames.DataFrame
│ Row │ t_solve │ obj_val  │ status  │ iter_num │
├─────┼─────────┼──────────┼─────────┼──────────┤
│ 1   │ 3.45469 │ 0.824339 │ Optimal │ 0        │</code></pre></div><p>The sailent optimization data is stored in the table above</p><table><tr><th>Variable</th><th>Description</th></tr><tr><td><code>t_solve</code></td><td>cpu time for optimization problem</td></tr><tr><td><code>obj_val</code></td><td>objective function value</td></tr><tr><td><code>iter_num</code></td><td>a variable for a higher-level algorithm, often these problems are nested</td></tr></table><p>One thing that may be noticed is the long time that it takes to solve the problem. This is typical for the first optimization, but after that even if the problem is modified the optimization time is greatly reduced.</p><h4><a class="nav-anchor" id="For-instance,-let&#39;s-re-run-the-optimization:-1" href="#For-instance,-let&#39;s-re-run-the-optimization:-1">For instance, let&#39;s re-run the optimization:</a></h4><div><pre><code class="language-julia">optimize!(n);
n.r.dfs_opt[2][:t_solve]</code></pre><pre><code class="language-none">1-element DataArrays.DataArray{Float64,1}:
 0.245892</code></pre></div><footer><hr/><a class="previous" href="../../index.html"><span class="direction">Previous</span><span class="title">Home</span></a><a class="next" href="../MoonLander/main.html"><span class="direction">Next</span><span class="title">Quick Ex#2: Moon Lander</span></a></footer></article></body></html>
